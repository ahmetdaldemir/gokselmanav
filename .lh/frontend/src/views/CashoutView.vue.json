{
    "sourceFile": "frontend/src/views/CashoutView.vue",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 8,
            "patches": [
                {
                    "date": 1748703712210,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1748704233455,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,9 +4,9 @@\n     <div class=\"order-summary\">\r\n       <h2>Sipariş Özeti</h2>\r\n       <ul>\r\n         <li v-for=\"item in cart.items\" :key=\"item.id\">\r\n-          {{ item.name }} x{{ item.quantity }} - {{ (item.price * item.quantity).toLocaleString('tr-TR', { style: 'currency', currency: 'TRY' }) }}\r\n+          {{ item.name }} x{{ item.quantity }} - {{ ((item.price * item.quantity) * 1.18).toLocaleString('tr-TR', { style: 'currency', currency: 'TRY' }) }}\r\n         </li>\r\n       </ul>\r\n       <div class=\"total\">\r\n         Toplam: <b>{{ total.toLocaleString('tr-TR', { style: 'currency', currency: 'TRY' }) }}</b>\r\n@@ -15,9 +15,9 @@\n     <form class=\"payment-form\" @submit.prevent=\"submitPayment\">\r\n       <h2>Kredi Kartı Bilgileri</h2>\r\n       <div>\r\n         <label>Kart Numarası</label>\r\n-        <input v-model=\"cardNumber\" maxlength=\"19\" required placeholder=\"0000 0000 0000 0000\" />\r\n+        <input v-model=\"cardNumber\" maxlength=\"16\" required placeholder=\"0000000000000000\" />\r\n       </div>\r\n       <div>\r\n         <label>Kart Sahibi</label>\r\n         <input v-model=\"cardHolder\" required placeholder=\"Ad Soyad\" />\r\n"
                },
                {
                    "date": 1748704369726,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,9 +8,9 @@\n           {{ item.name }} x{{ item.quantity }} - {{ ((item.price * item.quantity) * 1.18).toLocaleString('tr-TR', { style: 'currency', currency: 'TRY' }) }}\r\n         </li>\r\n       </ul>\r\n       <div class=\"total\">\r\n-        Toplam: <b>{{ total.toLocaleString('tr-TR', { style: 'currency', currency: 'TRY' }) }}</b>\r\n+        Toplam: <b>{{ totalWithTax.toLocaleString('tr-TR', { style: 'currency', currency: 'TRY' }) }}</b>\r\n       </div>\r\n     </div>\r\n     <form class=\"payment-form\" @submit.prevent=\"submitPayment\">\r\n       <h2>Kredi Kartı Bilgileri</h2>\r\n@@ -42,8 +42,9 @@\n import { useCartStore } from '@/stores/cart'\r\n \r\n const cart = useCartStore()\r\n const total = computed(() => cart.items.reduce((sum, item) => sum + item.price * item.quantity, 0))\r\n+const totalWithTax = computed(() => total.value * 1.18)\r\n \r\n const cardNumber = ref('')\r\n const cardHolder = ref('')\r\n const expiry = ref('')\r\n"
                },
                {
                    "date": 1748704492423,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -24,9 +24,9 @@\n       </div>\r\n       <div class=\"row\">\r\n         <div>\r\n           <label>Son Kullanma (AA/YY)</label>\r\n-          <input v-model=\"expiry\" maxlength=\"5\" required placeholder=\"AA/YY\" />\r\n+          <input v-model=\"expiry\" maxlength=\"5\" required placeholder=\"AA/YY\" @input=\"formatExpiry\" />\r\n         </div>\r\n         <div>\r\n           <label>CVV</label>\r\n           <input v-model=\"cvv\" maxlength=\"4\" required placeholder=\"CVV\" />\r\n@@ -49,8 +49,16 @@\n const cardHolder = ref('')\r\n const expiry = ref('')\r\n const cvv = ref('')\r\n \r\n+const formatExpiry = (e: Event) => {\r\n+  let value = (e.target as HTMLInputElement).value.replace(/[^0-9]/g, '')\r\n+  if (value.length > 2) {\r\n+    value = value.slice(0, 2) + '/' + value.slice(2, 4)\r\n+  }\r\n+  expiry.value = value\r\n+}\r\n+\r\n const submitPayment = () => {\r\n   // Şimdilik sadece console.log\r\n   console.log({ cardNumber: cardNumber.value, cardHolder: cardHolder.value, expiry: expiry.value, cvv: cvv.value })\r\n   alert('Ödeme backend entegrasyonu ile tamamlanacak!')\r\n"
                },
                {
                    "date": 1748775882649,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -57,12 +57,45 @@\n   }\r\n   expiry.value = value\r\n }\r\n \r\n-const submitPayment = () => {\r\n-  // Şimdilik sadece console.log\r\n-  console.log({ cardNumber: cardNumber.value, cardHolder: cardHolder.value, expiry: expiry.value, cvv: cvv.value })\r\n-  alert('Ödeme backend entegrasyonu ile tamamlanacak!')\r\n+const submitPayment = async () => {\r\n+  try {\r\n+    const [expiryMonth, expiryYear] = expiry.value.split('/');\r\n+    \r\n+    const paymentData = {\r\n+      cardNumber: cardNumber.value,\r\n+      cardHolder: cardHolder.value,\r\n+      expiry: expiry.value,\r\n+      cvv: cvv.value,\r\n+      amount: totalWithTax.value,\r\n+      orderDetails: {\r\n+        items: cart.items,\r\n+        total: totalWithTax.value\r\n+      }\r\n+    };\r\n+\r\n+    const response = await fetch('http://localhost:3000/payment', {\r\n+      method: 'POST',\r\n+      headers: {\r\n+        'Content-Type': 'application/json',\r\n+      },\r\n+      body: JSON.stringify(paymentData),\r\n+    });\r\n+\r\n+    const result = await response.json();\r\n+    \r\n+    if (result.success) {\r\n+      alert('Ödeme başarılı! Siparişiniz oluşturuldu.');\r\n+      cart.clearCart(); // Assuming you have a clearCart method in your store\r\n+      // You might want to redirect to a success page or order details page\r\n+    } else {\r\n+      alert(`Ödeme başarısız: ${result.message}`);\r\n+    }\r\n+  } catch (error) {\r\n+    console.error('Ödeme hatası:', error);\r\n+    alert('Ödeme işlemi sırasında bir hata oluştu. Lütfen tekrar deneyin.');\r\n+  }\r\n }\r\n </script>\r\n \r\n <style scoped>\r\n"
                },
                {
                    "date": 1748775927012,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -40,10 +40,17 @@\n <script setup lang=\"ts\">\r\n import { ref, computed } from 'vue'\r\n import { useCartStore } from '@/stores/cart'\r\n \r\n+interface CartItem {\r\n+  id: number;\r\n+  name: string;\r\n+  price: number;\r\n+  quantity: number;\r\n+}\r\n+\r\n const cart = useCartStore()\r\n-const total = computed(() => cart.items.reduce((sum, item) => sum + item.price * item.quantity, 0))\r\n+const total = computed(() => cart.items.reduce((sum: number, item: CartItem) => sum + item.price * item.quantity, 0))\r\n const totalWithTax = computed(() => total.value * 1.18)\r\n \r\n const cardNumber = ref('')\r\n const cardHolder = ref('')\r\n"
                },
                {
                    "date": 1748777245778,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -80,9 +80,9 @@\n         total: totalWithTax.value\r\n       }\r\n     };\r\n \r\n-    const response = await fetch('http://localhost:3000/payment', {\r\n+    const response = await fetch('http://localhost:3200/payment', {\r\n       method: 'POST',\r\n       headers: {\r\n         'Content-Type': 'application/json',\r\n       },\r\n"
                },
                {
                    "date": 1748777429419,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -80,9 +80,9 @@\n         total: totalWithTax.value\r\n       }\r\n     };\r\n \r\n-    const response = await fetch('http://localhost:3200/payment', {\r\n+    const response = await fetch('/api/payment', {\r\n       method: 'POST',\r\n       headers: {\r\n         'Content-Type': 'application/json',\r\n       },\r\n"
                },
                {
                    "date": 1748783430925,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -39,8 +39,9 @@\n \r\n <script setup lang=\"ts\">\r\n import { ref, computed } from 'vue'\r\n import { useCartStore } from '@/stores/cart'\r\n+import { useAuthStore } from '@/stores/auth'\r\n \r\n interface CartItem {\r\n   id: number;\r\n   name: string;\r\n@@ -48,8 +49,9 @@\n   quantity: number;\r\n }\r\n \r\n const cart = useCartStore()\r\n+const auth = useAuthStore()\r\n const total = computed(() => cart.items.reduce((sum: number, item: CartItem) => sum + item.price * item.quantity, 0))\r\n const totalWithTax = computed(() => total.value * 1.18)\r\n \r\n const cardNumber = ref('')\r\n@@ -75,10 +77,13 @@\n       expiry: expiry.value,\r\n       cvv: cvv.value,\r\n       amount: totalWithTax.value,\r\n       orderDetails: {\r\n-        items: cart.items,\r\n-        total: totalWithTax.value\r\n+        customerId: auth.user?.id,\r\n+        items: cart.items.map(item => ({\r\n+          productId: item.id,\r\n+          quantity: item.quantity\r\n+        }))\r\n       }\r\n     };\r\n \r\n     const response = await fetch('/api/payment', {\r\n"
                }
            ],
            "date": 1748703712210,
            "name": "Commit-0",
            "content": "<template>\r\n  <div class=\"cashout-page\">\r\n    <h1>Ödeme</h1>\r\n    <div class=\"order-summary\">\r\n      <h2>Sipariş Özeti</h2>\r\n      <ul>\r\n        <li v-for=\"item in cart.items\" :key=\"item.id\">\r\n          {{ item.name }} x{{ item.quantity }} - {{ (item.price * item.quantity).toLocaleString('tr-TR', { style: 'currency', currency: 'TRY' }) }}\r\n        </li>\r\n      </ul>\r\n      <div class=\"total\">\r\n        Toplam: <b>{{ total.toLocaleString('tr-TR', { style: 'currency', currency: 'TRY' }) }}</b>\r\n      </div>\r\n    </div>\r\n    <form class=\"payment-form\" @submit.prevent=\"submitPayment\">\r\n      <h2>Kredi Kartı Bilgileri</h2>\r\n      <div>\r\n        <label>Kart Numarası</label>\r\n        <input v-model=\"cardNumber\" maxlength=\"19\" required placeholder=\"0000 0000 0000 0000\" />\r\n      </div>\r\n      <div>\r\n        <label>Kart Sahibi</label>\r\n        <input v-model=\"cardHolder\" required placeholder=\"Ad Soyad\" />\r\n      </div>\r\n      <div class=\"row\">\r\n        <div>\r\n          <label>Son Kullanma (AA/YY)</label>\r\n          <input v-model=\"expiry\" maxlength=\"5\" required placeholder=\"AA/YY\" />\r\n        </div>\r\n        <div>\r\n          <label>CVV</label>\r\n          <input v-model=\"cvv\" maxlength=\"4\" required placeholder=\"CVV\" />\r\n        </div>\r\n      </div>\r\n      <button type=\"submit\">Ödemeyi Tamamla</button>\r\n    </form>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, computed } from 'vue'\r\nimport { useCartStore } from '@/stores/cart'\r\n\r\nconst cart = useCartStore()\r\nconst total = computed(() => cart.items.reduce((sum, item) => sum + item.price * item.quantity, 0))\r\n\r\nconst cardNumber = ref('')\r\nconst cardHolder = ref('')\r\nconst expiry = ref('')\r\nconst cvv = ref('')\r\n\r\nconst submitPayment = () => {\r\n  // Şimdilik sadece console.log\r\n  console.log({ cardNumber: cardNumber.value, cardHolder: cardHolder.value, expiry: expiry.value, cvv: cvv.value })\r\n  alert('Ödeme backend entegrasyonu ile tamamlanacak!')\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.cashout-page {\r\n  max-width: 500px;\r\n  margin: 2rem auto;\r\n  background: #fff;\r\n  border-radius: 12px;\r\n  box-shadow: 0 2px 8px rgba(0,0,0,0.06);\r\n  padding: 2rem;\r\n}\r\n.order-summary {\r\n  margin-bottom: 2rem;\r\n}\r\n.order-summary ul {\r\n  padding-left: 1.2rem;\r\n}\r\n.order-summary .total {\r\n  margin-top: 1rem;\r\n  font-size: 1.2rem;\r\n}\r\n.payment-form label {\r\n  display: block;\r\n  margin-bottom: 0.2rem;\r\n  font-weight: 500;\r\n}\r\n.payment-form input {\r\n  width: 100%;\r\n  padding: 0.5rem;\r\n  margin-bottom: 1rem;\r\n  border-radius: 6px;\r\n  border: 1px solid #ccc;\r\n  font-size: 1rem;\r\n}\r\n.payment-form .row {\r\n  display: flex;\r\n  gap: 1rem;\r\n}\r\nbutton[type=\"submit\"] {\r\n  width: 100%;\r\n  background: #1867C0;\r\n  color: #fff;\r\n  border: none;\r\n  border-radius: 6px;\r\n  padding: 0.8rem;\r\n  font-size: 1.1rem;\r\n  font-weight: 600;\r\n  cursor: pointer;\r\n  margin-top: 0.5rem;\r\n}\r\nbutton[type=\"submit\"]:hover {\r\n  background: #145399;\r\n}\r\n</style> "
        }
    ]
}